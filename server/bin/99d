#!/usr/bin/env python3
from datetime import timedelta
import gevent
import nn.funnel as funnel
from nn.handler import load_handler
from nn.stats import Stats
import sys

if __name__ == '__main__':
    stats = Stats(timedelta(seconds=10))
    handlers = [load_handler(file, stats) for file in sys.argv[1:]]
    def dispatch(event):
        for handler in handlers:
            gevent.spawn(handler, event)
    funnel.listen(('localhost', 1337), dispatch)
